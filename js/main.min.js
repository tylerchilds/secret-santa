function createGroup(){for(errors=[];$("create-errors").firstChild;)$("create-errors").removeChild($("create-errors").firstChild);host=$("create-host").value,group=$("create-group").value,$("add-name").focus(),$("step-1").className+=" prev",$("step-2").className+=" next"}function addSanta(){for(errors=[],clearErrors($("add-errors")),clearErrors($("send-errors"));$("send-errors").firstChild;)$("send-errors").removeChild($("send-errors").firstChild);var a=$("add-name").value,b=$("add-email").value;names.push(a),emails.push(b),hasDuplicates(names)&&errors.push("Name must be unique"),hasDuplicates(emails)&&errors.push("Email must be unique"),errors.length>0?(names.pop(),emails.pop(),writeErrors($("add-errors"),errors)):($("add-name").value="",$("add-email").value="",$("group").innerHTML=group,appendItem($("santa-list"),"li",a+" ("+b+")"))}function sendSantas(){errors=[],clearErrors($("send-errors"));var a=new XMLHttpRequest;a.onreadystatechange=function(){var b=4,c=200;a.readyState===b&&(a.status===c?($("step-2").className+=" prev",$("step-3").className+=" next"):writeErrors($("send-errors"),[JSON.parse(a.response).error]))},a.open("POST","index.php",!0),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),a.send(JSON.stringify({names:names,emails:emails,host:host,group:group,send:"true"}))}function hasDuplicates(a){for(var b=[],c=0;c<a.length;++c){var d=a[c];if(b.indexOf(d)!==-1)return!0;b.push(d)}return!1}function $(a){return document.getElementById(a)}function writeErrors(a,b){var c=appendItem(a,"p",void 0);b.forEach(function(a){appendItem(c,"div",a)})}function appendItem(a,b,c){var d=document.createElement(b);if(a.appendChild(d),c){var e=document.createTextNode(c);d.appendChild(e)}return d}function clearErrors(a){for(;a.firstChild;)a.removeChild(a.firstChild)}var host,group,names=[],emails=[],elems={},errors=[];window.onload=function(){$("create-host").focus(),$("create-form").addEventListener("submit",function(a){a.preventDefault(),createGroup()}),$("add-form").addEventListener("submit",function(a){a.preventDefault(),addSanta(),a.target.querySelectorAll("input")[0].focus()}),$("send-form").addEventListener("submit",function(a){a.preventDefault(),sendSantas()})};
